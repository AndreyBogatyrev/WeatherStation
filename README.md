# WeatherStation

Проект написан, используя CMSIS. К STM32F103 по I2C подключены: датчик BME280 (измеряет температуру, давление, относительную влажность), часы реального времени DS3231 (дата и время), дисплей LCD1602 подключен через I2C расширитель портов PCF8574.

Управление реализовано с помощью 1 кнопки, позволяющее включать/выключать подсветку, устанавливать время, дату и день недели. При быстром нажатии из режима отображения/режима выключенной подсветки происходит выключение/включение подсветки соответственно. При долгом (более секунды) нажатии, контроллер переходит в режим настройки - на дисплее отображаются дата и время, а текущиее настраиваемое значение подсвечивается мигающим курсором. При быстром нажатии в режиме настройки происходит изменение настраиваемого значения. При долгом нажатии в режиме настройки происходит переключение на следуещее настраиваемое значение. После настройки последнего значения (года), контроллер записывает настроенные данные в DS3231 и возвращается в режим отображения.

Смена изображения происходит каждую секунду по внешнему прерыванию от DS3231. 5 секунд отображается информация с DS3231, затем 5 секунд с BME280. Внешнее прерывание настроено на пин PA0. Обработка нажатия кнопки происходит по прерываанию от TIM1, подключена к CH1 (пин PA8). Лучше подключать плату DS3231 со встроенной батарейкой, чтобы при выключении общего питания время не сбрасывалось.

P.S. В текущей реализации при первом нажатии на кнопку происходит сразу несколько прерываний. В Errata информацию об исправлении этой проблемы я не нашел. После включения питания и пройденной инициализации советую пару раз быстро нажать на кнопку - после чего прерывания будут обрабатываться корректно. В папке Release, файл weather_station.hex может использоваться для прошивки любым удобным способом.
